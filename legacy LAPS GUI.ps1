Add-Type -AssemblyName PresentationCore
Add-Type -Assembly PresentationFramework

$icon_base64 = @'
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
'@

$icon = New-Object System.Windows.Media.Imaging.BitMapImage
$icon.BeginInit()
$icon.StreamSource = [System.IO.MemoryStream][System.Convert]::FromBase64String($icon_base64)
$icon.EndInit()
$icon.Freeze()

Add-Type -AssemblyName System.Windows.Forms

[xml]$XAML = @"
<Window
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        Title="Legacy LAPS GUI" Height="220" Width="400">
    <Grid>
    <Label Content="Computer name" HorizontalAlignment="Left" Margin="10,6,0,0" VerticalAlignment="Top"/>
    <Label Content="Password" HorizontalAlignment="Left" Margin="46,29,0,0" VerticalAlignment="Top" RenderTransformOrigin="0.502,-0.606"/>
    <Label Content="Expiration date" HorizontalAlignment="Left" Margin="17,55,0,0" VerticalAlignment="Top"/>
    <TextBox Name="ComputerName" HorizontalAlignment="Left" Margin="111,10,0,0" TextWrapping="Wrap" Text="" VerticalAlignment="Top" Width="260" Height="20"/>
    <TextBox Name="Password" HorizontalAlignment="Left" Margin="111,33,0,0" TextWrapping="Wrap" Text="" VerticalAlignment="Top" Width="260" Height="20" IsReadOnly="True"/>
    <TextBox Name="Expiration" HorizontalAlignment="Left" Margin="111,58,0,0" TextWrapping="Wrap" Text="" VerticalAlignment="Top" Width="260" Height="20"/>
    <Button Name="GetPassword" Content="Get password" HorizontalAlignment="Left" Margin="17,93,0,0" VerticalAlignment="Top" Width="354" Height="35" Background="#FF0033A0" Foreground="White"/>
    <Button Name="ExpirePassword" Content="Expire password" HorizontalAlignment="Left" Margin="17,133,0,0" VerticalAlignment="Top" Width="354" Height="35" Background="#FF0033A0" Foreground="White"/>
</Grid>
</Window>
"@

$reader=(New-Object System.Xml.XmlNodeReader $xaml) 
try{
    $Form=[Windows.Markup.XamlReader]::Load( $reader )
    $Form.icon = $icon
}
catch
{
    Write-Host "Unable to load Windows.Markup.XamlReader"
    exit
}

$xaml.SelectNodes("//*[@Name]") | ForEach-Object { Set-Variable -Name ($_.Name) -Value $Form.FindName($_.Name) -Scope Global }

$runspace = [runspacefactory]::CreateRunspace()
$runspace.Open()
$runspace.SessionStateProxy.SetVariable("ComputerName", [string]$ComputerName)
$runspace.SessionStateProxy.SetVariable("Password", $Password)
$runspace.SessionStateProxy.SetVariable("Expiration", $Expiration)

function GetPassword
{
    $computerDetails = Get-ADComputer -Identity ($ComputerName.Text) -properties ms-Mcs-AdmPwd, ms-Mcs-AdmPwdExpirationTime | Select ms-Mcs-AdmPwd, ms-Mcs-AdmPwdExpirationTime
    $LAPS_password = $computerDetails."ms-Mcs-AdmPwd"
    $Password.Text = $LAPS_password

    $expirationDate = $computerDetails."ms-Mcs-AdmPwdExpirationTime"
    if ($expirationDate -ge 0)
    {
        $expirationDate = $([datetime]::FromFileTime([convert]::ToInt64($expirationDate)))
    }
    $Expiration.Text = "{0:yyyy-MM-dd HH:mm:ss}" -f [datetime]$expirationDate
}

function ExpirePassword
{
    $now = Get-Date
    $nowFileTime = $now.ToFileTime()
    try
    {
        Set-ADComputer -Identity ($ComputerName.Text) -Replace @{'ms-Mcs-AdmPwdExpirationTime' = $nowFileTime}
        $Expiration.Text = $now
    }
    catch
    {
        $Expiration.Text = "Error"
    }
}

$GetPassword.add_click({
    GetPassword
})

$ExpirePassword.add_click({
    ExpirePassword
})

$form.ShowDialog() | Out-Null

$powershell.EndInvoke($job)
$runspace.Close()